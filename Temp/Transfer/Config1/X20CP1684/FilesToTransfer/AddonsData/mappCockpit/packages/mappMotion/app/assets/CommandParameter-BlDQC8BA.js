import{_ as le}from"./ToggleButton.vue_vue_type_script_setup_true_lang-DkopjQqz.js";import{m as ce,cp as me,cq as de,S as y,a5 as ue,ag as fe,Z as pe,$ as ve,Y as ye,U as z,o as I,q as we,u as w,V as C,a6 as x,x as Ce,W as s,cv as L,B as A,A as j,a8 as he,aj as ge,ak as W,al as De,b3 as q,Q as $,cw as ke,_ as Pe}from"./index-BsJ70qdJ.js";import{D as Ie}from"./Common-6GBgVX-S.js";import{E as xe}from"./edit-C46edU9r.js";import{T as F}from"./textbox-Bf71oXsD.js";import{N as Le}from"./numerictextbox-CWVY5c2y.js";const be={class:"parameter-table"},_e={class:"grid-value-row"},Ne={class:"grid-value-left"},Ve={class:"grid-icon-right"},H=0,Se=ce({__name:"CommandParameter",props:{componentid:{type:String,required:!0},command:{type:Object,default:null},commandName:{type:String,default:""},parameters:{type:Array,default:null},editable:{type:Boolean,default:!1},nameColWidth:{type:String,default:Ie}},emits:["changedParameter","resizeColumn","remove-parameter"],setup(M,{emit:O}){const n=M,d=O,u=me(n.componentid),{Logging:b}=de(u()),_=y(),N=y(n.command),f=y(null);let i;ue("grid",[fe,xe]);const U={allowAdding:!0,allowEditing:!0,allowDeleting:!0,mode:"Normal"},Q={mode:"Auto"},G={mode:"Both",type:"Single"};function Y(e){const t=e==null?void 0:e.data;if(!t)return;t.IsLinked&&!n.editable&&e.cell.classList.add("e-disabled")}function Z(){f.value&&(i=f.value,i.ej2Instances.element.addEventListener("mouseup",e=>{e.target&&V(S(e.target))}),i.ej2Instances.element.addEventListener("keydown",e=>{e.target&&e.code==="Space"&&V(S(e.target))}))}function V(e){e!==void 0&&(i.endEdit(),i.selectRow(e),i.selectCell({rowIndex:e,cellIndex:1}),i.startEdit())}function S(e){if(e.classList.contains("e-rowcell")){const t=e.getAttribute("Index");if(t!==null)return parseInt(t)}}let l,p,h=!1;const J={create:function(){return p=document.createElement("input"),p},read:function(){return h?p.value:l.value},destroy:function(){X(),l.destroy(),d("changedParameter",r.value,[])},write:function(e){var t,a;if(e.rowData.EnumMap===void 0)e.rowData.DataType==="String"?l=new F({value:e.rowData.strValue}):l=new Le({showSpinButton:!1,format:"0.######",value:+e.rowData.strValue,enabled:!((t=e==null?void 0:e.rowData)!=null&&t.IsLinked)||n.editable}),h=!0;else{const o=[];for(const[,m]of e.rowData.EnumMap)o.push(m);l=new q({dataSource:o,text:e.rowData.strValue,query:new $,enabled:!((a=e==null?void 0:e.rowData)!=null&&a.IsLinked)||n.editable}),h=!1}l.appendTo(p)}};class E extends q{constructor(t){super(t)}getActiveIndex(){return this.activeIndex}}let c,g;const K={create:function(){return g=document.createElement("input"),g},read:function(){return c.value},destroy:function(){if(c instanceof E){const t=c.getActiveIndex();if(t===void 0)return;const a=N.value.getCommonParameters();if(!a||(a[t],!a[t]))return;const o=a[t].param;if(o.Type=L.LinkableParent,!r.value)return;r.value.pop(),r.value.push(o),d("changedParameter",r.value,[]),setTimeout(()=>{i.ej2Instances.deleteRecord("DisplayName",void 0),i.ej2Instances.addRecord(o,P+1)},50)}},write:function(e){var t;if(e.rowData.Ref==="newCommonParameter"&&n.command){const a=[],o=N.value.getCommonParameters();if(o)for(let m=0;m<o.length;m++){const se=o[m].param;a.push({value:m,text:se.DisplayName})}c=new E({dataSource:a,text:e.rowData.DisplayName,query:new $,enabled:!((t=e==null?void 0:e.rowData)!=null&&t.IsLinked)||n.editable,close:function(){}})}else c=new F({value:e.rowData.DisplayName});c.appendTo(g)}};pe(async()=>{document.addEventListener("click",B)}),ve(async()=>{document.removeEventListener("click",B)});function B(e){_.value.contains(e.target)||i.endEdit()}const r=y(n.parameters);function D(){u().updateParameterFiltering(n.commandName)}function k(){r.value=[];for(const e in n.parameters){const t=n.parameters[+e];t.IsVisible&&r.value.push(t)}}ye(async()=>{T(),D(),k()}),z(()=>n.parameters,()=>{r.value,T(),D(),k()},{deep:!0});function T(e){if(b.value>H+1,n.parameters)for(const t in n.parameters){const a=n.parameters[+t];if(!a)continue;const o=u().restoreParameterValue("",n.commandName,a.Ref);(!a.IsLinked||n.editable)&&(o?a.Value=o:a.Value=a.DefaultValue),a.updateStrValue()}}function X(){for(const e in r.value){const t=r.value[+e];b.value>H+10&&(`${e}`,t.Value,t.DefaultValue),t.isChanged()?u().storeParameterValue("",n.commandName,t.Ref,t.Value):u().removeParameterValue("",n.commandName,t.Ref)}D(),k()}function ee(e){ke.ToggleIsLinked(v),i.ej2Instances.updateRow(P,v),d("changedParameter",r.value,[])}function te(e){n.command,d("remove-parameter",e),setTimeout(()=>{n.command,i.ej2Instances.deleteRecord("DisplayName",e)},50)}let P=1,v=null;const ae=function(e){v=r.value[e.rowIndex],P=e.rowIndex};function ne(){var t;return((t=f.value)==null?void 0:t.getColumnByField("DisplayName")).width}z(()=>n.nameColWidth,()=>{var t;const e=(t=f.value)==null?void 0:t.getColumnByField("DisplayName");e.width=n.nameColWidth});function oe(e){var t;((t=e.column)==null?void 0:t.field)==="OrderID"&&(e.cancel=!0)}function re(e){R(e)}function ie(e){R(e)}function R(e){if(!e.column)return;const t=e.column.width;`${n.commandName}`,ne(),d("resizeColumn",t)}return(e,t)=>(I(),we("div",{class:"container",ref_key:"parameterArrayContainer",ref:_},[w("div",be,[C(s(De),{ref_key:"gridRef",ref:f,"data-testid":"commandParameter",onLoad:Z,"data-source":r.value,"edit-settings":U,"allow-resizing":!0,"resize-settings":Q,"resize-start":oe,resizing:re,"resize-stop":ie,"row-selected":ae,"selection-settings":G,"query-cell-info":Y,"grid-lines":"Both"},{columnTemplate:x(({data:a})=>[w("div",_e,[w("div",Ne,Ce(a.strValue+(a.Unit?" "+a.Unit:"")),1),w("div",Ve,[a.Type==s(L).Linkable?(I(),A(le,{key:0,"button-position-absolute":!1,"icon-css":"icon-link ","css-class":"e-inherit",value:a.IsLinked,"emit-delay-time":5,onClick:o=>ee(a)},null,8,["value","onClick"])):j("",!0),a.Type==s(L).LinkableParent?(I(),A(s(he),{key:1,onClick:o=>te(a),"icon-css":"icon-bin","css-class":"e-inherit e-appbar-menu remove-button e-small",title:"remove linked Parameter"},null,8,["onClick"])):j("",!0)])])]),default:x(()=>[C(s(ge),null,{default:x(()=>[C(s(W),{"is-primary-key":!0,field:"DisplayName","header-text":"Parameter","min-width":"50",width:n.nameColWidth,edit:K},null,8,["width"]),C(s(W),{field:"strValue","header-text":"Value",template:"columnTemplate",edit:J,width:"auto"})]),_:1})]),_:1},8,["data-source"])])],512))}}),je=Pe(Se,[["__scopeId","data-v-e5588ed1"]]);export{je as default};
