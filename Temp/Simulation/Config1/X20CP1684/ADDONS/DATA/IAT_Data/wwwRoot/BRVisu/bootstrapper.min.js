!function(){"use strict";var app={favicon:"/favicon.ico",bootLogo:"/BRVisu/assets/img/br_logo.png",bootColor:"#FAFAFA",visuStyle:"/BRVisu/release/brease_core.min.css",defaultVisu:void 0,start:function(){return app.preloaded={},app.defaultVisu=void 0,app.visuList=void 0,app.params=app.urlParser(window.location.pathname,window.location.search),Promise.all([_loadJSON("/services/server/getConfiguration").then(_getConfigurationResponseHandler),_loadJSON("/0_visulist.json").then(_getVisuListResponseHandler)]).then(()=>{_loadEScripts(),_startRedirect()})},getClientInfo:function(t){var i={hostname:document.location.hostname||"",browser:platform.name||"",operatingsystem:platform.os.family||"",aspectratio:screen.width&&screen.height?roundTo(screen.width/screen.height,2):1,orientation:window.matchMedia("(orientation: landscape)").matches?"landscape":"portrait",displaywidth:screen.width||0,displayheight:screen.height||0};_requestClientIpAdress(function(e){i.ipaddress=new Ipaddress(e?""+e:""),"function"==typeof t&&t(i)})},interpretClientRules:function(arrRules,clientInfo){return arrRules.filter(function(actRule){var ipaddress=this.ipaddress,hostname=this.hostname,browser=this.browser,operatingsystem=this.operatingsystem,aspectratio=this.aspectratio,orientation=this.orientation,displaywidth=this.displaywidth,displayheight=this.displayheight;return eval(actRule.op)},clientInfo).map(function(e){return{name:e.name,visuid:e.visu.toLowerCase()}})},getRules:function(e){var t,i,a,o=[];if("string"==typeof e&&0<e.length){try{i=JSON.parse(e)}catch(e){return"error"}t=i.redirectconfig}if(!t)return"noConfigurations";if(0===Object.getOwnPropertyNames(t).length)return"noRules";for(a in t)o.push({name:a,visu:t[a].visu,op:t[a].op});return o},urlParser:function(e,t){var i={};if(0===t.lastIndexOf("?"))for(var a=(t=t.substring(1)).split("&"),o=0;o<a.length;o+=1){var s=a[o];-1!==s.indexOf("=")&&(i[(s=s.split("="))[0].toLowerCase()]=s[1].toLowerCase())}t=e.substring(1);return""!==t&&-1===t.indexOf(".")&&-1===t.indexOf("/")&&(i.visuid=t.toLowerCase()),i},scriptLoader:function(e){return Promise.all(e.map(i=>new Promise(e=>{var t=document.createElement("script");t.src=i,t.async=!1,t.onload=e,document.head.appendChild(t)})))},logger:function(e,t,i,a,o,s){o&&console.log(o);o=new XMLHttpRequest,e=[{eventId:e,verboseLvl:t,text:i||"",args:a}],t="",i=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/services/server/sendEventLog";try{t=JSON.stringify({Data:e})}catch(e){return}o.onreadystatechange=function(){4===this.readyState&&"function"==typeof s&&s()},o.open("POST",i,!0),o.setRequestHeader("Content-Type","application/json; charset=utf-8"),o.setRequestHeader("Cache-Control","no-cache"),o.setRequestHeader("Accept","*/*"),o.send(t)},showUserMessage:function(e){var t=document.getElementById("appContainer");t.textContent=e,t.style.fontSize="22px"},visuStarter:function(e){var i=e.configurations;_setFavicon(i),_loadImage(i,function(e,t){_setSplashscreen(i,e,t),_loadVisuStyle()})}},HTTP_STATUS_CODE={OK:200,NOT_FOUND:404,INVALID_TOKEN:498};function _getConfigurationResponseHandler(e){if(!0===e.success){var t;try{t=JSON.parse(e.strJSON)}catch(e){return void app.showUserMessage("error in configuration file")}void 0!==t&&t.status&&0===t.status.code&&(app.preloaded.configuration=t.configuration,t.configuration)&&t.configuration.defaultVisu&&(app.defaultVisu=t.configuration.defaultVisu.toLowerCase())}else app.showUserMessage("loading configuration: "+e.cause)}function _getVisuListResponseHandler(e){if(!0===e.success){var t;try{t=JSON.parse(e.strJSON)}catch(e){console.log("error in visu list")}void 0!==t&&(app.visuList=t)}}function _loadEScripts(){app.escriptPromise=Promise.resolve(),window.escripts={};"2"===app.preloaded?.configuration?.EventbindingExecution&&(app.escriptPromise=app.scriptLoader(["release/escripts.js"]))}function _startRedirect(){(_isMapp(app.params.visuid)?_start:(!Array.isArray(app.visuList)||1!==app.visuList.length||void 0!==app.params.visuid&&app.params.visuid.toLowerCase()!==app.visuList[0].toLowerCase()||(app.defaultVisu=app.visuList[0],app.params.visuid=app.visuList[0]),_parseRules))()}function _parseRules(){_loadJSON("/services/server/getRedirectConfig").then(function(e){e=app.getRules(e.strJSON);"noRules"===e?void 0===app.defaultVisu?(app.showUserMessage("no rules in redirect configuration are specified and no default visualization is found"),app.logger(-2134803120,0,"",["noConfig"],"no rules in redirect configuration are specified and no default visualization is found")):(app.params.visuid=app.defaultVisu&&app.defaultVisu.toLowerCase(),_start()):"error"===e?app.showUserMessage("error in rules file redirect.json"):"noConfigurations"===e?(void 0===app.params.visuid&&(app.params.visuid=app.defaultVisu&&app.defaultVisu.toLowerCase()),_start()):_checkRules(e,_processRulesResult)})}function _processRulesResult(e){void 0!==e.find(function(e){return e.visuid===app.params.visuid})?_start():void 0!==e[0]?void 0!==app.params.visuid&&app.params.visuid!==app.defaultVisu?app.logger(-2134803126,0,"",[app.params.visuid],'the requested visualization "'+app.params.visuid+'" was blocked due to configured redirect rules',function(){_redirectVisu(e[0].visuid,e[0].name)}):_redirectVisu(e[0].visuid,e[0].name):void 0!==app.defaultVisu?void 0!==app.params.visuid&&app.params.visuid!==app.defaultVisu?app.logger(-2134803126,0,"",[app.params.visuid],'the requested visualization "'+app.params.visuid+'" was blocked due to configured redirect rules',function(){_redirectVisu(app.defaultVisu)}):_redirectVisu(app.defaultVisu):void 0===app.params.visuid?app.showUserMessage("no visuId specified"):app.showUserMessage('the requested visualization "'+app.params.visuid+'" was blocked due to configured redirect rules')}function _redirectVisu(e,t){void 0===t?console.log("redirect client to default visualization:"+e):console.log('redirect client to visualization "'+e+'" due to rule:'+t),app.params.visuid=e,_start()}function _start(){void 0===app.params.visuid?app.showUserMessage("no visuId specified"):(app.params.visuid=app.params.visuid.toLowerCase(),document.title="Visualization "+app.params.visuid,_loadVisu(app.params.visuid))}function _loadVisu(i){_loadJSON("/"+i+".json").then(function(e){if(!0===e.success){var t;try{t=JSON.parse(e.strJSON)}catch(e){return void app.showUserMessage("error in visu file "+i+".json")}t.id=i,app.preloaded.visu=t,app.visuStarter(t)}else app.showUserMessage('loading visu with id "'+i+'" failed: '+e.cause)})}function _initBrease(){"true"===app.params.debug&&console.warn("debug flag not supported anymore!"),app.scriptLoader(["release/br.js","release/brease.js","release/widgets.js","release/cwidgets.js"]).then(async()=>{await app.escriptPromise,_startBrease()})}function _createConfig(){var e={warn:void 0!==app.params.clientwarnings&&"true"===app.params.clientwarnings.toLowerCase(),debug:void 0!==app.params.debug&&"true"===app.params.debug.toLowerCase(),editMode:void 0!==app.params.editmode&&"true"===app.params.editmode.toLowerCase(),detection:{mobile:_checkMobile(),os:platform&&platform.os?platform.os.family:navigator.platform,browser:platform.name},watchdog:void 0!==app.params.watchdog?parseInt(app.params.watchdog,10):void 0};return platform&&platform.os&&platform.os.family?e.detection.ios="ios"===platform.os.family.toLowerCase():e.detection.ios=-1!==navigator.platform.search(/(iphone|ipod|ipad)/gi),e}function _startBrease(){var e=_createConfig(),e=(window.breaseApplication.preloaded=app.preloaded,window.breaseApplication.start({visuId:app.params.visuid},e),document.getElementById("bootstrapper"));e&&document.body.removeChild(e)}function _loadJSON(e){return new Promise(function(t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Accept","*/*"),i.onreadystatechange=function(){var e=parseInt(i.status,10);i.readyState===XMLHttpRequest.DONE&&(e===HTTP_STATUS_CODE.OK?t({strJSON:i.responseText,success:!0}):e===HTTP_STATUS_CODE.NOT_FOUND?t({success:!1,cause:"not found"}):0===e||e===HTTP_STATUS_CODE.INVALID_TOKEN?window._connectionErrorHandler():t({success:!1,cause:"could not load file"}))},i.ontimeout=function(){window._connectionErrorHandler()},i.send(null)})}function _setFavicon(e){var e=(e&&e.favicon?e:app).favicon,t="image/x-icon";0<e.lastIndexOf(".gif")?t="image/gif":0<e.lastIndexOf(".png")&&(t="image/png"),_addElement("link",{href:e,rel:"icon",type:t},document.head)}function _loadImage(e,t){var e=(e&&e.bootLogo?e:app).bootLogo,i=new Image;i.onload=function(){t(!0,i)},i.onerror=function(){t(!1)},i.src=e}function _setSplashscreen(e,t,i){var a,o=(e&&e.bootLogo?e:app).bootLogo,e=(e&&e.bootColor?e:app).bootColor,s=document.getElementById("splashscreen");s&&((a=s.style).position="fixed",a.top="0",a.left="0",a.width="100%",a.height="100%",a.zIndex="2",!0===t?(a.background=e+" url("+i.src+") no-repeat 50% 50%",(i.width>window.innerWidth||i.height>window.innerHeight)&&(a.backgroundSize="contain")):(a.backgroundColor=e,a.display="inline-flex",a.flexDirection="column",a.flexWrap="nowrap",a.justifyContent="center",a.alignContent="center",a.alignItems="center",_addElement("div",{style:"display:inline-box;width:50%;background-color:white;color:black;font-size:18px;line-height:18px;text-align:center;padding:12px 0;flex:0 0 auto;"},s,"boot image not found: "+o),_addElement("img",{src:app.bootLogo,style:"margin:12px 0;flex:0 0 auto;"},s)))}function onStyleLoad(){_initBrease()}function onStyleError(){"function"==typeof window._connectionErrorHandler&&window._connectionErrorHandler()}function _loadVisuStyle(){var e;_stylesheetLoaded(app.visuStyle)?_initBrease():((e=_addElement("link",{rel:"stylesheet",href:app.visuStyle},document.head)).addEventListener("load",onStyleLoad),e.addEventListener("error",onStyleError))}function _addElement(e,t,i,a){var o,s=document.createElement(e);for(o in t)s.setAttribute(o,t[o]);return void 0!==a&&(s.textContent=a),i.appendChild(s),s}function _stylesheetLoaded(){return void 0!==_getStylesheetByPath(app.visuStyle.substring(app.visuStyle.lastIndexOf("/release")))}function _getStylesheetByPath(e){var t;if(""!==e)for(var i=0;i<document.styleSheets.length;i+=1){var a=document.styleSheets[i].href;if(a&&-1!==a.indexOf(e)){t=document.styleSheets[i];break}}return t}function _checkMobile(){var e=!1,t=!1,i=navigator.userAgent,a=i||navigator.vendor||window.opera;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(e=!0),!/(tablet|ipad|playbook|silk)|(android(?!.*mobile))/i.test(i)&&-1===navigator.platform.toLowerCase().indexOf("ipad")||(t=!0),e||t}function Ipaddress(e){this.tmpipaddress=this.convert(e)}function _checkRules(t,i){app.getClientInfo(function(e){e=app.interpretClientRules(t,e);"function"==typeof i&&i(e)})}function _requestClientIpAdress(e){var t=new XMLHttpRequest,i=window.location.protocol+"//"+window.location.hostname+(""!==window.location.port?":"+window.location.port:"")+"/client/getIp";t.onreadystatechange=function(){4===this.readyState&&200===this.status&&"function"==typeof e&&e(JSON.parse(this.responseText).ip)},t.open("GET",i,!0),t.setRequestHeader("Content-Type","application/json; charset=utf-8"),t.setRequestHeader("Cache-Control","no-cache"),t.setRequestHeader("Accept","*/*"),t.send(null)}function roundTo(e,t){t=Math.pow(10,t);return Math.round(t*e)/t}function _isMapp(e){return"string"==typeof e&&0===e.indexOf("mapp")}Ipaddress.prototype={ge:function(e){return this.gt(e)||this.eq(e)},le:function(e){return this.lt(e)||this.eq(e)},gt:function(e){for(var t=this.convert(e),i=0;i<t.length;i+=1){if(this.tmpipaddress[i]>t[i])return!0;if(this.tmpipaddress[i]<t[i])break}return!1},lt:function(e){for(var t=this.convert(e),i=0;i<t.length;i+=1){if(this.tmpipaddress[i]<t[i])return!0;if(this.tmpipaddress[i]>t[i])break}return!1},eq:function(e){for(var t=this.convert(e),i=!0,a=0;a<t.length;a+=1)i=i&&this.tmpipaddress[a]===t[a];return i},neq:function(e){for(var t=this.convert(e),i=0;i<t.length;i+=1)if(this.tmpipaddress[i]!==t[i])return!0;return!1},convert:function(e){return e.split(".").map(function(e){return parseInt(e,10)})}},"function"==typeof define&&define.amd?define("bootstrapper",[],function(){return app.Ipaddress=Ipaddress,app}):app.start()}();