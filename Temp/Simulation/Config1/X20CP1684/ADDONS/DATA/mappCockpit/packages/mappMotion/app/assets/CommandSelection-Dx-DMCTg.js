import{_ as A,a as B}from"./CommandProgress.vue_vue_type_script_setup_true_lang-2RoPCCP4.js";import{m as N,S as x,a5 as T,cd as j,cp as O,cq as q,Y as z,U as u,o as R,B as S,a6 as w,u as y,x as G,W as p,cr as M,A as I,V as b,aj as U,ak as W,al as Y}from"./index-BsJ70qdJ.js";import{E as F}from"./edit-C46edU9r.js";import"./numerictextbox-CWVY5c2y.js";import"./textbox-Bf71oXsD.js";const H={class:"fullRow"},J={class:"cmd-name"},c=10,ne=N({__name:"CommandSelection",props:{componentid:{type:String,required:!0},commands:{type:Array,required:!0},selectedCommand:{type:Object,default:null},executingCommand:{type:Object,default:null},abortingCommand:{type:Object,default:null}},emits:["changeCommand"],setup(k,{emit:E}){const o=k,$=E,r=x(null);let d=null;T("grid",[F]);function D(){a.value>c&&r.value,r.value&&(d=r.value)}const L={allowEditing:!0},P=j(o.componentid),i=O(o.componentid),{Logging:a}=q(i());function V(e){e.isInteracted&&e.data&&(a.value>2,$("changeCommand",e.data),e.isInteracted=!1)}const s=x();z(async()=>{await i().initialize(),h()});let C=null;u(()=>o.commands,()=>{var t;if(C!=null)for(const n of C)i().Commands&&((t=i().Commands)!=null&&t.has(n.id))&&i().unsubscribeExecutables(n.id);h();const e=i().getSelectedCommand(P().getView);e&&a.value>c+0&&console.info("Selected Command=",e),C=o.commands},{deep:!0});const _=x(-1);function h(){var t,n;if(!i().isInitialized){a.value>c+3;return}a.value>c+2,s.value=[];let e=-1;for(const f in o.commands){const v=o.commands[f];if(i().Commands&&((t=i().Commands)!=null&&t.has(v.id))){const g=(n=i().getCommands)==null?void 0:n.get(v.id);if(!g)continue;s.value.push(g),i().subscribeExecutables(v.id),g&&o.selectedCommand&&g.Ref===o.selectedCommand.Ref&&(e=+f)}}setTimeout(()=>{_.value=e},25),a.value>c+1&&o.commands}function l(e){a.value>10,s.value&&(d==null||d.updateRow(e,s.value[e]))}let m=-1;return u(()=>o.executingCommand,e=>{if(a.value>c+1,m!=-1&&(!e||!s.value)){l(m),m=-1;return}let t=-1;for(const n in s.value)s.value[+n].Ref==e.Ref&&(t=+n);t!=-1&&t!=m&&(a.value>c+1&&`${e.Ref}${m}${t}`,setTimeout(()=>{m==-1?l(m):d==null||d.refresh()},250),m=t)}),u(()=>o.abortingCommand,e=>{a.value>c;let t=-1;for(const n in s.value)s.value[+n].Ref==e.Ref&&(t=+n);t!=-1&&l(t)}),u(()=>{var e;return(e=o.executingCommand)==null?void 0:e.IsIndeterminateProgress},e=>{o.executingCommand&&(a.value>c&&(`${o.executingCommand.Ref}${e}`,o.executingCommand),l(m))}),u(()=>{var e;return(e=o.executingCommand)==null?void 0:e.IsStandaloneExecution},e=>{o.executingCommand&&(a.value>c&&(`${o.executingCommand.Ref}${e}`,o.executingCommand),l(m))}),(e,t)=>(R(),S(p(Y),{ref_key:"gridRef",ref:r,onLoad:D,"data-source":s.value,"edit-settings":L,"selected-row-index":_.value,onRowSelected:V},{columnTemplate:w(({data:n})=>[y("div",H,[y("div",J,G(n==null?void 0:n.DisplayName),1),n.IsStandaloneExecution&&n.IsIndeterminateProgress?(R(),S(A,{key:0,progress:p(M),"is-indeterminate":!0},null,8,["progress"])):I("",!0),n.IsStandaloneExecution&&!n.IsIndeterminateProgress?(R(),S(B,{key:1,id:n.Ref,componentid:o.componentid,"command-ref":n.Ref},null,8,["id","componentid","command-ref"])):I("",!0)])]),default:w(()=>[b(p(U),null,{default:w(()=>[b(p(W),{field:"DisplayName","header-text":"Commands","is-primary-key":!0,template:"columnTemplate"})]),_:1})]),_:1},8,["data-source","selected-row-index"]))}});export{ne as default};
