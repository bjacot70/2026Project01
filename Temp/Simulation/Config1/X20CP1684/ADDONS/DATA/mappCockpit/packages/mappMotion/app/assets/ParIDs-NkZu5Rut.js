import{a0 as l,aE as A,aF as M,aG as h,a2 as a,aH as r,aI as R,aJ as f,Y as g,$ as C}from"./index-BsJ70qdJ.js";let S=null;const d="parID",u=t=>l(`${t}/ParID`,{state:()=>({Logging:A(d),StoreName:`parIDStore(${t})`,Data:new Map,Info:M(),InitStep:0,SubscriptionId:null,PollingActive:!1,UpdateIntervalMin:500,UpdateInterval:500,Mock:!1,MockedData:[3,330,65,5e3,12e3,5,4,15,1,5,4,18,20,.01,0,0,0,2.5,800.44885,0,770,111.741127,-28.87763,2,140,40]}),getters:{isInitialized:i=>i.InitStep==99},actions:{async initMockData(){this.Mock=!0,this.InitStep=99},async initialize(){const o=`${this.StoreName}.initialize `;if(!this.Mock){if(!t||t==""){console.error(o+"invalid Axis!");return}if(this.Logging>1,this.InitStep>0){this.Logging>0&&(o+"",this.InitStep);try{await h(()=>this.isInitialized)}catch{console.error(o+"timeout")}return}if(this.InitStep=1,!await a.waitUntilConnected()){this.Logging>0&&console.error(o+"no Connection");return}this.Logging>0&&(o+"",this.Data),this.InitStep=99}},async reInitialize(){this.InitStep=0,await this.initialize()},async updateValues(i){if(this.Mock)return;const o=await a.ParID.readValues(t,i);if(o.Status!=r.OK){console.error(`${this.StoreName} readValues failed`,o.Status);return}for(let e=0;e<i.length;e++){const T=i[e],s=this.Data.get(T);if(!s){console.warn(`${this.StoreName} invalid ParID`,T);continue}const n=o.DataArr[e];s.setValue(n),s.informSubscribers(n)}},async readValues(i){if(this.Logging>1&&`${this.StoreName}`,this.Mock)return this.MockedData;for(const e of i)if(!this.Data.get(e)){const s=this.Info().getParIdInfo(e);this.Data.set(e,new R(e,s))}await this.updateValues(i);const o=[];for(let e=0;e<i.length;e++){const T=i[e],s=this.Data.get(T);s&&o.push(s.Value)}return o},async subscribeValue(i,o){this.Logging>1&&`${this.StoreName}${i}`;const e=[];let T=this.Data.get(i);if(!T){const n=this.Info().getParIdInfo(i);this.Data.set(i,new R(i,n)),T=this.Data.get(i)}if(!T)return console.error("ParIDStore: invalid item",i),e;const s=T.getActiveSubscriptions();return e.push(T.addSubscriber(o)),s==0&&await this.updateSubscription(),e},async unsubscribeValue(i,o){if(this.Mock)return;this.Logging>1&&`${this.StoreName}${i}`;const e=this.Data.get(i);e&&(e.removeSubscriber(o==null?void 0:o[0]),e.getActiveSubscriptions()==0&&await this.updateSubscription())},async updateSubscription(){S=f(S,this.renewSubscription,100,this.StoreName)},async renewSubscription(){this.Logging>1&&`${this.StoreName}`,await this.unsubscribe();const i=[];for(const[o,e]of this.Data)e.getActiveSubscriptions()>0&&i.push(o);if(i.length){if(this.SubscriptionId&&clearInterval(this.SubscriptionId),!a.isOpcUaConnected())return;const o=new Date().getTime();await this.updateValues(i);const e=new Date().getTime();this.UpdateInterval=Math.max((e-o)*2,this.UpdateIntervalMin);const T=this;if(this.Mock)return;this.SubscriptionId=setInterval(async function(){if(T.PollingActive||!a.isOpcUaConnected())return;T.PollingActive=!0;const s=await a.ParID.readValues(t,i);if(s.Status!=r.OK){console.error(`${T.StoreName} polling failed`,s.Status),T.SubscriptionId&&clearInterval(T.SubscriptionId),T.PollingActive=!1;return}for(let n=0;n<i.length;n++){const O=i[n],_=T.Data.get(O);if(!_)continue;const c=s.DataArr[n];_.Value!=c&&T.subscriptionValueChange(t,O,c)}T.PollingActive=!1},this.UpdateInterval),this.Logging>0&&(`${this.StoreName}`,this.SubscriptionId)}},subscriptionValueChange(i,o,e){if(this.Logging>1&&`${this.StoreName}${i}${o}${e}`,t!=i){console.error(`${this.StoreName} invalid component`,i);return}const T=this.Data.get(o);if(!T){console.error("not found",o);return}T.setValue(e),T.informSubscribers(e)},async unsubscribe(){this.Logging>1&&(`${this.StoreName}`,this.SubscriptionId),this.SubscriptionId&&clearInterval(this.SubscriptionId),this.SubscriptionId=null},getParIdValue(i){var o;return(o=this.Data.get(i))==null?void 0:o.Value}}});function L(t,i,o){const e=u(t);return g(async()=>{if(await e().initialize(),e().isInitialized)for(const T of i)e().subscribeValue(T,s=>{if(!i.includes(T)){console.error(`useParIDSubscription(${t}, ${T}) value changed, but not in parIDs!`);return}o&&o(T,s)});else console.error(`useParIDSubscription(${t}, ...) store init failed!`)}),C(()=>{for(const T of i)e().unsubscribeValue(T)}),e}var b=(t=>(t[t.MOTOR_TYPE=30]="MOTOR_TYPE",t[t.MOTOR_POLEPAIRS=47]="MOTOR_POLEPAIRS",t[t.MOTOR_VOLTAGE_RATED=48]="MOTOR_VOLTAGE_RATED",t[t.MOTOR_VOLTAGE_CONST=49]="MOTOR_VOLTAGE_CONST",t[t.MOTOR_SPEED_RATED=50]="MOTOR_SPEED_RATED",t[t.MOTOR_SPEED_MAX=51]="MOTOR_SPEED_MAX",t[t.MOTOR_TORQ_STALL=52]="MOTOR_TORQ_STALL",t[t.MOTOR_TORQ_RATED=53]="MOTOR_TORQ_RATED",t[t.MOTOR_TORQ_MAX=54]="MOTOR_TORQ_MAX",t[t.MOTOR_TORQ_CONST=55]="MOTOR_TORQ_CONST",t[t.MOTOR_CURR_STALL=56]="MOTOR_CURR_STALL",t[t.MOTOR_CURR_RATED=57]="MOTOR_CURR_RATED",t[t.MOTOR_CURR_MAX=58]="MOTOR_CURR_MAX",t[t.MOTOR_STATOR_RESISTANCE=60]="MOTOR_STATOR_RESISTANCE",t[t.MOTOR_STATOR_INDUCTANCE=61]="MOTOR_STATOR_INDUCTANCE",t[t.MOTOR_LIMIT_TEMPERATURE=74]="MOTOR_LIMIT_TEMPERATURE",t[t.MOTOR_ROTOR_RESISTANCE=76]="MOTOR_ROTOR_RESISTANCE",t[t.MOTOR_ROTOR_INDUCTANCE=77]="MOTOR_ROTOR_INDUCTANCE",t[t.MOTOR_MUTUAL_INDUCTANCE=78]="MOTOR_MUTUAL_INDUCTANCE",t[t.MOTOR_MAGNETIZING_CURR=79]="MOTOR_MAGNETIZING_CURR",t[t.PCTRL_V_ACT=92]="PCTRL_V_ACT",t[t.PCTRL_S_ACT=111]="PCTRL_S_ACT",t[t.PCTRL_S_SET=113]="PCTRL_S_SET",t[t.HOMING_TR_S_REL=151]="HOMING_TR_S_REL",t[t.STATUS_CYCLIC_BITS=179]="STATUS_CYCLIC_BITS",t[t.ICTRL_ISQ_ACT=214]="ICTRL_ISQ_ACT",t[t.UDC_ACT=298]="UDC_ACT",t[t.UDC_BLEEDER_ON=345]="UDC_BLEEDER_ON",t[t.TEMP_MOTOR=381]="TEMP_MOTOR",t[t.UDC_NOMINAL=390]="UDC_NOMINAL",t[t.MOTOR_TEMP_AMB=668]="MOTOR_TEMP_AMB",t[t.FCTRL_MODE=870]="FCTRL_MODE",t[t.FWCTRL_ISD0=954]="FWCTRL_ISD0",t[t.FWCTRL_SPEED0=959]="FWCTRL_SPEED0",t[t.HOMING_STATUS_BITS=1589]="HOMING_STATUS_BITS",t[t.STAT_ONBOARD_TRIGGER1=1598]="STAT_ONBOARD_TRIGGER1",t[t.STAT_ONBOARD_TRIGGER2=1599]="STAT_ONBOARD_TRIGGER2",t[t.POWERSTAGE_STAT=868]="POWERSTAGE_STAT",t[t.DIG_IN_FORCE_ENABLE=184]="DIG_IN_FORCE_ENABLE",t))(b||{});export{b as P,L as a,u};
